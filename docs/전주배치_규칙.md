# 전주 배치 규칙 — 구간 수와 40m 제한

설계 결과에서 **"신설 전주 N개"**와 **총 거리**, **40m 전주 간 거리 제한**이 어떻게 맞는지 정리합니다.

**전제**: 수용가 위치에 **첫 신설 전주를 배치**하기로 했습니다.

---

## 1. 구간 수 = 신설 전주 수 (첫 전주는 수용가 위치)

**첫 신설 전주가 수용가 위치**에 있으므로, **"신설 전주 N개"** = **구간 N개**입니다.

경로 구조:

```
[수용가 = 신설전주1] → [신설전주2] → [신설전주3] → 기설전주
        구간1              구간2          구간3
```

- **구간** = 인접한 두 전주(또는 신설전주↔신설전주, 마지막 신설전주↔기설전주) 사이 선로 길이
- **첫 신설 전주**는 수용가와 같은 위치이므로, 구간은 **신설전주1→2, 2→3, …, N→기설전주**로 **N개**입니다.

따라서 **총 거리 133.2m, 신설 전주 3개**인 경우:

- 구간 수 = **3**
- 구간당 거리 = 133.2 ÷ 3 = **44.4m** → **40m 초과** → 위반.
- 40m를 지키려면 **신설 전주 4개**(구간 4개)가 필요합니다. (133.2 ÷ 4 = 33.3m)

---

## 2. 알고리즘의 40m 제한

**파일**: `app/core/pole_allocator.py`, `app/config.py`

- **POLE_INTERVAL = 40m**: 전주와 전주 사이 거리는 40m를 넘지 않도록 배치합니다.
- **MIN_DISTANCE_TO_EXISTING_POLE = 15m**: 기설전주 15m 이내에는 신설 전주를 두지 않습니다. (이유는 아래 §2.1 참고)
- **첫 신설 전주 = 수용가 위치**: 수용가와 같은 지점에 첫 전주를 두므로, 첫 번째 “구간”은 신설전주1→신설전주2 구간이며 40m 이하여야 합니다.

### 2.1 기설전주 15m 이내에 신설 전주를 두지 않는 이유

코드·기술명세에는 “15m 이내 미배치”만 정의되어 있고, **근거 규정**은 문서에 남겨져 있지 않습니다.  
다만 배전 설계·시공 관행상 보통 아래와 같은 이유로 이해할 수 있습니다.

1. **접속 구간으로 보는 관행**  
   기설전주에 신설 인입선을 접속할 때, **기설전주로부터 15m 이내**는 “접속 구간”으로 보고, 그 안에 **별도 신설 전주를 두지 않는다**는 해석이 있습니다.  
   즉, “마지막 15m는 기설전주에서 뻗어 나온 선로만 두고, 그 안에는 전주를 추가로 세우지 않는다”는 뜻입니다.

2. **불필요한 전주 억제**  
   기설전주 바로 옆(몇 m~十余 m)에 신설 전주를 세우면, 사실상 **기설전주에 직접 인입**하면 되는 구간을 불필요하게 전주 한 본 더 세워서 늘리는 꼴이 됩니다.  
   “15m 이내면 기설전주에 직접 접속”으로 처리하고, 그보다 먼 구간부터만 신설 전주를 두는 식으로 **중복 시설을 막는** 목적으로 볼 수 있습니다.

3. **작업·안전 여유**  
   기설전주 주변에서 가선·굴착·인입 작업을 할 때, **최소 작업 반경·안전 이격**을 두기 위해 “기설전주로부터 일정 거리 이내에는 신설 전주를 세우지 않는다”는 내부 규칙/관행이 있을 수 있습니다.

**주의**: 위는 일반적인 해석이며, **정확한 근거(배전설계기준·한전 공급규정·발주처 지침 등)**는 도메인 담당자가 확인하는 것이 좋습니다.  
15m 값을 규정에서 따온 경우, 해당 규정명·조항을 이 문서나 `app/core/pole_allocator.py` 주석에 적어 두면 유지보수에 도움이 됩니다.

규칙 요약:

1. **첫 신설 전주**: 수용가 위치(0m)에 필수 배치 (우리 합의 사항)
2. 이후: 40m 간격으로 전주 배치 (구간당 40m 초과 불가)
3. 기설전주 15m 이내에는 신설 전주 배치 안 함
4. **마지막 구간**(마지막 신설전주 ~ 기설전주)도 40m 이하여야 하므로,  
   마지막 구간이 40m를 넘으면 유효 구간 끝(기설전주 15m 전)에 전주 1개를 더 둡니다.

---

## 3. 예시: 총 거리 133.2m

- **신설 전주 3개**면 구간 3개 → 133.2 ÷ 3 = 44.4m > 40m → **위반**.
- 40m를 지키려면 **신설 전주 4개**(구간 4개)가 필요합니다.
- 코드에서는 **마지막 구간이 40m를 넘을 때** 유효 거리 끝(118.2m = 133.2 − 15)에 전주를 하나 더 두어  
  **신설 전주 4개**, 구간 40m·40m·38.2m·15m처럼 모두 40m 이하가 되게 합니다.
- 즉, 133.2m 같은 경우에는 “3개만 두면 44.4m로 위반”이므로, **4개(수용가 위치 1 + 경로 위 3)**로 배치해 구간 4개·각 40m 이하가 되도록 합니다.

---

## 4. 참고 코드 위치

| 내용 | 파일 | 참고 위치 |
|------|------|-----------|
| 40m 간격·마지막 구간 보정 | `app/core/pole_allocator.py` | `_calculate_pole_positions()` |
| POLE_INTERVAL, FIRST_POLE_MAX_DISTANCE | `app/config.py` | 전주 배치 관련 상수 |

---

**요약**:  
- **수용가 위치에 첫 신설 전주를 배치**하기로 했으므로, **"신설 전주 N개"** = **구간 N개**입니다.  
- 모든 구간이 40m 이하여야 하므로, 마지막 구간이 40m를 넘으면 유효 구간 끝(기설전주 15m 전)에 전주를 하나 더 둡니다.
